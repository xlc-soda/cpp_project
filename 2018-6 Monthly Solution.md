# 2018-6 Monthly Solution

## A 签到二叉树

> 保证每组数据有且仅有最后一行为三个零
>
> 输入文件**不超过500000行**
>
> ***满意时他给出的询问为Ai=Bi=Ci=0***
>
> $A_i=encA_i+Ans_{i-1}, B_i=encB_i+Ans_{i-1},C_i=encC_i+Ans_{i-1}$

加密方式带入式子：

 $$(encA_i+Ans_{i-1})*(x+1)*(w_{Ls(x)})^2+(encB_i+Ans_{i-1}+1)*x*(w_{Rs(x)})+(encC_i+Ans_{i-1}+x)=0$$

其中$x=Ans_i$，整理可得：
$$
Ans_{i-1}=-\frac{encA_i*(Ans_i+1)*(w_{Ls(x)})^2+(encB_i+1)*Ans_i*(w_{Rs(x)})+(encC_i+Ans_i)}{(Ans_i+1)*(w_{Ls(x)})^2+Ans_i*(w_{Rs(x)})+1}
$$
将所有询问读入，已知最后一个询问的$encA_i, encB_i,encC_i$计算出的$A_i,B_i,C_i$一定均为0，于是可得倒数第二个询问的答案。然后如上式倒推即可求得所有询问的答案。

## B 汨罗江心悼屈原

​	“有向无环图”其实是个干扰条件，有意义的条件只有“如果u和v之间存在一条边，那么u和v至少有一个会被选中”，也就是说我们要求的原图中的最小点覆盖。

​	不妨令点集为V，边集的对称闭包为E（即把有向图当作无向图），那么我们的任务就是要选择一个尽可能小的集合$S \in V$，使得对于$V^2$中的任意二元组<u, v>，满足：*如果$<u, v> \in E$ 则 $u \in S \bigvee v \in S$ 。*它的逆否命题为：*如果$u\notin S \bigwedge v\notin S$，则$<u,v> \notin E$。*

​	不妨令$\overline{S} = V - S, \overline{E} = V^2-E$，则上面的逆否命题可以写成：*$如果u\in \overline{S} \bigwedge v \in \overline{S}，则<u, v> \in \overline{E}$* 。这就意味着$\overline{S}$是补图$\overline{G} = <V, \overline{E}>$中的一个完全子图。那么我们的任务就变成了：选择一个集合$S \in V，使得\overline{S} = V- S是补图\overline{G}= <V, \overline{E}>的最大团$。

​	根据上面的推导，我们就可以在线性时间内将一个一般图的最小点覆盖问题规约到最大团问题，而最大团可以通过带剪枝的搜索算法Bron-Kerbosch来求解。

## C Asm.Def吃粽子

​	将每种口味的粽子表示为一个布尔变量，对于粽子A而言，$A$表示把它放入豪华套餐，而$\overline{A}$表示不放。那么一条Type=0的限制就相当于一个命题$A\rightarrow B$，或者写作$\overline{A} \or B$;一条Type=1的限制就相当于布尔命题$A \rightarrow \overline{B}$，或者写作$\overline{A} \or \overline{B}$。如果我们按照标号由大到小的顺序依次考虑每一种粽子，那么如果当前粽子**可以**加入套餐的话它就**一定**会被加入套餐。否则，由于每个粽子产生的满足感都大于后续的所有粽子的满足感之和，即使我们能将后续的所有粽子都加入套餐也不可能比“只加入当前粽子”的方案更优。

​	因此，我们要做的就是按照求解“2-SAT问题的最大字典序解”的思路，从大到小依次考虑每个粽子是否可以选择。

## D 匈牙利选课

虽然题目里写的是匈牙利算法，但是实际上用的不是匈牙利算法，而是由匈牙利算法衍生出来的，用来求解最大权值匹配的km算法。一种解法是建立一个一边是同学，一边是课程位置的二分图（如果一个课程有k个位置，那么就建立k个点），对于每个同学，都向其想上而非最喜爱的课程的所有位置连一条权值为s(一个任意大于n的值）的边，再向最喜爱的课程的所有位置连一条权值为s+1的边。这样，求出的最大权值匹配就保证了在尽量多的人有课可上的同时，让尽量多的人上了最喜欢的课程，答案为最大权值-n*s

## E Erangel

给树上三点，树上两点距离可由LCA和深度得出。两两计算LCA，选择与三个点距离总和最小的点即可。

## F Too many fans

给无向图，将没有直接边相连的点分一起。即求补图的联通块的数量。

链表优化BFS。对于某一点，在原图中与该点无边相连的点在补图中必在同一联通块中，BFS找联通块。初始所有点在链表上，对于已经计算过的联通块中的点从链表中删去，可以大幅减少BFS时候枚举点的时间。

## G 签到最短路

最短路裸题，输入数据保证卡spfa，建议用dijkstra或巧妙优化过的spfa